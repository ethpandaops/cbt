# CBT Configuration for Example Environment
# This single configuration file is used by all components in the docker-compose setup

# Logging level
logging: debug

# Metrics server address
metricsAddr: ":9090"

# Health check server address
healthCheckAddr: ":8083"

# Optional pprof profiling
# pprofAddr: ":6060"

# API server configuration
api:
  enabled: true
  addr: ":8888"  # API listens on port 8888

# Frontend service configuration
frontend:
  enabled: true
  addr: ":8080"  # Frontend listens on port 8080

# ClickHouse configuration (used by all components)
clickhouse:
  url: "http://clickhouse:8123"
  cluster: ""
  localSuffix: "_local"
  queryTimeout: 300s  # Increased from 30s to handle large queries
  insertTimeout: 5m    # Increased from 60s for bulk operations
  debug: false
  keepAlive: 30s
  # Admin tables configuration for each transformation type
  admin:
    incremental:
      database: admin
      table: cbt_incremental
    scheduled:
      database: admin
      table: cbt_scheduled

# Redis configuration (used by coordinator, worker, and rerun command)
redis:
  url: "redis://redis:6379"

# Scheduler settings
scheduler:
  concurrency: 10
  consolidation: "@every 10m"

# Worker-specific settings (ignored by coordinator and CLI)
worker:
  concurrency: 10
  # No model tag filtering in example
  # modelTags:
  #   include: []
  #   exclude: []
  #   require: []
  shutdownTimeout: 30

# Model configuration with optional default databases
models:
  external:
    paths:
      - "/app/models/external"
    defaultDatabase: "ethereum"  # Default database for external models
  transformations:
    paths:
      - "/app/models/transformations"
    defaultDatabase: "analytics"  # Default database for transformation models
    # Optional: Global custom environment variables for all transformations
    env:
      API_KEY: "global_api_key_12345"
      ENVIRONMENT: "development"

# Optional: Override configuration for specific transformation models
# Useful for environment-specific adjustments (staging, production, etc.)
# You can use either full ID (database.table) or table-only format for models using default database
# Overrides apply different fields based on transformation type (incremental vs scheduled)
# overrides:
#   # Disable a model entirely (full ID format)
#   analytics.block_never_loads:
#     enabled: false
#
#   # INCREMENTAL TRANSFORMATION OVERRIDES
#   # Override using table-only format (works because model uses defaultDatabase: "analytics")
#   block_propagation:
#     config:
#       interval:
#         max: 7200  # Increase to 2 hours in staging
#       schedules:
#         forwardfill: "@every 10m"  # Slower schedule
#         backfill: ""  # Disable backfill (use empty string)
#       limits:
#         min: 1000000  # Start from specific position
#         max: 2000000  # End at specific position
#       tags:
#         - "staging-only"
#
#   # SCHEDULED TRANSFORMATION OVERRIDES
#   # Scheduled transformations use a single 'schedule' field instead of 'schedules'
#   entity_changes:
#     config:
#       schedule: "@every 10m"  # Override the cron schedule
#       tags:
#         - "low-priority"
#
#   # Models with custom databases must use full ID
#   custom_db.special_model:
#     config:
#       schedule: "@hourly"  # For scheduled transformation
#       # OR for incremental:
#       # interval:
#       #   max: 3600
#       # schedules:
#       #   forwardfill: "@every 5m"
interval_types:
  slot:
  - name: Slot
    expression: "math.floor((value - 1606824023) / 12)"
  - name: Datetime
    format: datetime
    expression: "value * 1000"
  block:
  - name: Block number