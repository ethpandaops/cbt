# CBT Configuration

# Logging level: panic, fatal, warn, info, debug, trace
logging: info

# Metrics server address
metricsAddr: ":9090"

# Health check server address (optional)
healthCheckAddr: ":8081"

# Pprof server address for profiling (optional)
# Uncomment to enable profiling
# pprofAddr: ":6060"

# ClickHouse configuration
clickhouse:
  # Connection URL (required)
  # Supports multiple formats:
  # - Native protocol (recommended): clickhouse://user:pass@localhost:9000
  # - HTTP protocol: http://user:pass@localhost:8123
  # - HTTPS protocol: https://user:pass@localhost:8443
  url: "clickhouse://localhost:9000"

  # Cluster configuration (optional, for distributed deployments)
  # cluster: "default"
  # localSuffix: "_local"

  # Admin table configuration (optional)
  # Each transformation type requires its own admin table
  # admin:
  #   incremental:
  #     database: admin          # Database for incremental transformations
  #     table: cbt_incremental   # Table for incremental transformations
  #   scheduled:
  #     database: admin          # Database for scheduled transformations
  #     table: cbt_scheduled     # Table for scheduled transformations

  # Query timeout
  queryTimeout: 30s

  # Insert timeout
  insertTimeout: 60s

  # Enable debug logging for queries
  debug: false

  # Connection pool settings (optional)
  # maxOpenConns: 10
  # maxIdleConns: 5
  # connMaxLifetime: 1h

  # TLS settings (optional, for secure connections)
  # insecureSkipVerify: false

# Redis configuration
redis:
  # Redis connection URL (required)
  url: "redis://localhost:6379/0"

# Scheduling settings
scheduler:
  # Maximum number of concurrent scheduling operations
  concurrency: 10

  # Admin table consolidation schedule (optional)
  # Controls how often the admin table is consolidated to optimize storage
  # Uses asynq cron format: @every duration, @hourly, @daily, or cron expression
  # Default: @every 10m
  consolidation: "@every 10m"

# Worker settings
worker:
  # Number of concurrent tasks to process
  concurrency: 10

  # Model tags for filtering which models this instance processes (optional)
  # Useful for running specialized instances for specific model types
  # tags:
  #   - "batch"
  #   - "analytics"

  # Time to wait for graceful shutdown (e.g., 30s, 1m, 5m)
  shutdownTimeout: 30s

# Model configuration (optional)
# Configure where to find external and transformation models and default cluster/database
# Defaults to models/external and models/transformations if not specified
# models:
#   external:
#     # Optional: Set defaultCluster if using ClickHouse cluster functions
#     # defaultCluster: "my_cluster"
#     defaultDatabase: ethereum # optional - default database for external models
#     paths:
#       - "models/external" # default
#       - "/additional/external/models"
#   transformations:
#     defaultDatabase: analytics # optional - default database for transformation models
#     paths:
#       - "models/transformations" # default
#       - "/additional/transformation/models"
#   # Optional: Global custom environment variables for all models
#   # These are available in:
#   #   - SQL templates: Access via {{ .env.KEY_NAME }}
#   #   - Command/script transformations: Access via $KEY_NAME
#   # Model-specific env vars (defined in model frontmatter) override these global values
#   env:
#     API_KEY: "your_api_key_here"
#     ENVIRONMENT: "production"
#     REGION: "us-east-1"

# Frontend service configuration (includes API)
# The frontend serves both the web UI and API endpoints on the same port
# API endpoints are available at /api/v1/*
frontend:
  # Enable or disable the frontend and API service
  enabled: true
  # Address to serve the frontend and API on
  addr: ":8080"

# Interval type transformations (optional)
# Define how interval types can be represented and transformed for display in the frontend
# Each interval type (matching interval.type in models) can have multiple transformation steps
#
# interval_types:
#   # The interval.type name from your models
#   slot:
#     # Raw value (no transformation, no formatting)
#     - name: raw
#
#     # Display as formatted datetime
#     - name: timestamp
#       format: datetime
#
#     # Transform to epoch number
#     - name: epoch
#       expression: "math.floor((value - 1606824023) / 12)"
#
#     # Transform to epoch and format as datetime
#     - name: epoch_as_date
#       expression: "math.floor((value - 1606824023) / 12) * 1000"
#       format: datetime
#
#   # Another interval type example
#   epoch:
#     - name: timestamp
#       format: datetime
#
#     - name: slot
#       expression: "value * 32 * 12"  # epoch -> slot conversion
#
#     - name: date_only
#       format: date
